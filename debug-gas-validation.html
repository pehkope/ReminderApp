<!DOCTYPE html>
<html>
<head>
    <title>ğŸ”‘ Google Apps Script API Key Debug</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ” Google Apps Script API Key Validation Debug</h1>
    <div id="results"></div>
    
    <script>
        const NEW_API_URL = "https://script.google.com/macros/s/AKfycbxpQyWZkyiMXJIoJrHLEGZPOm-TgqBlW3ftSkmZTuDK6Ya-OZOlKkPW3RNTRQetNeNb/exec";
        const API_KEY = "reminder-tablet-2024";
        const CLIENT_ID = "mom";
        
        async function debugGasValidation() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>ğŸ”„ Debug kÃ¤ynnissÃ¤...</h2>';
            
            try {
                // 1. Testaa ilman API keytÃ¤
                console.log('ğŸš« Testaa ilman API keytÃ¤...');
                const noKeyUrl = `${NEW_API_URL}?clientID=${CLIENT_ID}&_t=${Date.now()}`;
                
                const noKeyResponse = await fetch(noKeyUrl);
                const noKeyResult = await noKeyResponse.text();
                
                results.innerHTML += `<h3>ğŸš« Ilman API keytÃ¤:</h3>`;
                results.innerHTML += `<p><strong>URL:</strong> ${noKeyUrl}</p>`;
                results.innerHTML += `<p><strong>Status:</strong> ${noKeyResponse.status}</p>`;
                results.innerHTML += `<p><strong>Vastaus:</strong> <pre>${noKeyResult}</pre></p>`;
                
                // 2. Testaa debug parametrilla
                console.log('ğŸ” Testaa debug properties...');
                const debugUrl = `${NEW_API_URL}?debug=properties&_t=${Date.now()}`;
                
                const debugResponse = await fetch(debugUrl);
                const debugResult = await debugResponse.text();
                
                results.innerHTML += `<h3>ğŸ” Debug Properties:</h3>`;
                results.innerHTML += `<p><strong>URL:</strong> ${debugUrl}</p>`;
                results.innerHTML += `<p><strong>Status:</strong> ${debugResponse.status}</p>`;
                results.innerHTML += `<p><strong>Vastaus:</strong> <pre>${debugResult}</pre></p>`;
                
                // 3. Testaa oikealla API keylla
                console.log('ğŸ”‘ Testaa oikealla API keylla...');
                const validUrl = `${NEW_API_URL}?clientID=${CLIENT_ID}&apiKey=${API_KEY}&_t=${Date.now()}`;
                
                const validResponse = await fetch(validUrl);
                const validResult = await validResponse.text();
                
                results.innerHTML += `<h3>ğŸ”‘ Oikealla API keylla:</h3>`;
                results.innerHTML += `<p><strong>URL:</strong> ${validUrl}</p>`;
                results.innerHTML += `<p><strong>Status:</strong> ${validResponse.status}</p>`;
                results.innerHTML += `<p><strong>Vastaus:</strong> <pre>${validResult.substring(0, 500)}...</pre></p>`;
                
                // 4. Testaa vÃ¤Ã¤rÃ¤llÃ¤ API keylla
                console.log('âŒ Testaa vÃ¤Ã¤rÃ¤llÃ¤ API keylla...');
                const wrongUrl = `${NEW_API_URL}?clientID=${CLIENT_ID}&apiKey=wrong-key&_t=${Date.now()}`;
                
                const wrongResponse = await fetch(wrongUrl);
                const wrongResult = await wrongResponse.text();
                
                results.innerHTML += `<h3>âŒ VÃ¤Ã¤rÃ¤llÃ¤ API keylla:</h3>`;
                results.innerHTML += `<p><strong>URL:</strong> ${wrongUrl}</p>`;
                results.innerHTML += `<p><strong>Status:</strong> ${wrongResponse.status}</p>`;
                results.innerHTML += `<p><strong>Vastaus:</strong> <pre>${wrongResult}</pre></p>`;
                
                // 5. Analysoi tulokset
                results.innerHTML += `<h2>ğŸ“Š ANALYYSI:</h2>`;
                
                if (validResult.includes("Invalid API key")) {
                    results.innerHTML += `<p style="color: red;">âŒ <strong>ONGELMA:</strong> Oikea API key hylÃ¤tÃ¤Ã¤n!</p>`;
                    results.innerHTML += `<p>ğŸ”§ <strong>Mahdolliset syyt:</strong></p>`;
                    results.innerHTML += `<ul>`;
                    results.innerHTML += `<li>ğŸ”‘ Script Properties VALID_API_KEYS ei ole oikein</li>`;
                    results.innerHTML += `<li>ğŸ› validateApiKey_() funktio buginen</li>`;
                    results.innerHTML += `<li>ğŸ“ API key vertailu case-sensitiivinen</li>`;
                    results.innerHTML += `<li>ğŸ”„ Deployment ei pÃ¤ivittÃ¤nyt koodia</li>`;
                    results.innerHTML += `</ul>`;
                } else if (validResult.includes("clientID")) {
                    results.innerHTML += `<p style="color: green;">âœ… <strong>TOIMII:</strong> API key hyvÃ¤ksytty!</p>`;
                } else {
                    results.innerHTML += `<p style="color: orange;">â“ <strong>EPÃ„SELVÃ„:</strong> Odottamaton vastaus</p>`;
                }
                
            } catch (error) {
                console.error('âŒ Virhe debuggauksessa:', error);
                results.innerHTML += `<h3 style="color: red;">âŒ Virhe: ${error.message}</h3>`;
            }
        }
        
        // Aloita debug automaattisesti
        debugGasValidation();
    </script>
</body>
</html>