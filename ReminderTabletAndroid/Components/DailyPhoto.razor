@using ReminderTabletAndroid.Services
@using ReminderTabletAndroid.Models

<div class="main-photo photo-clickable" @onclick="() => OnPhotoClick.InvokeAsync(new PhotoClickArgs { ImageUrl = ImageUrl, Caption = Caption })">
    @if (!string.IsNullOrEmpty(ImageUrl))
    {
        <img src="@ImageUrl" alt="@Caption" style="width: 100%; height: 100%; object-fit: cover;" 
             @onload="@(() => LoggingService.LogImageLoad(ImageUrl, true))"
             @onerror="@(() => LoggingService.LogImageLoad(ImageUrl, false))" />
        <div class="photo-overlay">
            <span class="zoom-icon">üîç</span>
            <span>Suurenna</span>
        </div>
    }
    else
    {
        <div class="no-photo">‚ùå Ei kuva-URL:a saatavilla</div>
    }
</div>

@code {
    [Parameter] public string? ApiPhotoUrl { get; set; }
    [Parameter] public string? ApiPhotoCaption { get; set; }
    [Parameter] public EventCallback<PhotoClickArgs> OnPhotoClick { get; set; }

    public class PhotoClickArgs
    {
        public string ImageUrl { get; set; } = "";
        public string Caption { get; set; } = "";
    }

    private string ImageUrl => GetImageUrl();
    private string Caption => GetImageCaption();

    private string GetImageUrl()
    {
        // Ensisijaisesti API:sta
        if (!string.IsNullOrEmpty(ApiPhotoUrl))
        {
            return ApiPhotoUrl;
        }
        
        // Toissijaisesti frontend:n viikottainen simulaatio (backend ei ole viel√§ k√§yt√∂ss√§)
        var simulatedUrl = TestDataService.GetDefaultPhotoUrl();
        return simulatedUrl;
    }

    private string GetImageCaption()
    {
        if (!string.IsNullOrEmpty(ApiPhotoCaption))
            return ApiPhotoCaption;
            
        return TestDataService.GetDefaultPhotoCaption();
    }
}