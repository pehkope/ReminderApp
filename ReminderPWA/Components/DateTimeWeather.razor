@using ReminderTabletNew2.Models
@using System.Globalization

<div class="header-section">
    <div class="time-container">
        <div class="date-text">@GetFinnishDate()</div>
        
        <div class="time-main">
            <div class="main-time">@CurrentTime.ToString("HH:mm")</div>
            <div class="time-period">@TimeOfDayText</div>
        </div>
        
        @* SÃ¤Ã¤tietoon parannettu nÃ¤kyvyys *@
        <div class="weather-compact">
            @if (Weather != null)
            {
                <span class="weather-icon">@GetWeatherIcon(Weather.Description)</span>
                <div class="weather-info">
                    <span class="weather-temp">@Weather.Temperature</span>
                    <span class="weather-desc">@GetFinnishWeatherDescription(Weather.Description)</span>
                </div>
            }
            else
            {
                <span class="weather-icon">ğŸŒ¤ï¸</span>
                <div class="weather-info">
                    <span class="weather-temp">22Â°C</span>
                    <span class="weather-desc">Ladataan sÃ¤Ã¤tietoja...</span>
                </div>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public required DateTime CurrentTime { get; set; }
    [Parameter] public required string TimeOfDayText { get; set; }
    [Parameter] public Weather? Weather { get; set; }

    private string GetFinnishDate()
    {
        // Manuaaliset kÃ¤Ã¤nnÃ¶kset varmistaaksemme suomenkielisyyden
        var finnishDays = new[] { "Sunnuntai", "Maanantai", "Tiistai", "Keskiviikko", "Torstai", "Perjantai", "Lauantai" };
        var finnishMonths = new[] { "", "tammikuu", "helmikuu", "maaliskuu", "huhtikuu", "toukokuu", "kesÃ¤kuu", 
                                   "heinÃ¤kuu", "elokuu", "syyskuu", "lokakuu", "marraskuu", "joulukuu" };
        
        var dayName = finnishDays[(int)CurrentTime.DayOfWeek];
        var monthName = finnishMonths[CurrentTime.Month];
        
        return $"{dayName} {CurrentTime.Day}. {monthName} {CurrentTime.Year}";
    }

    private string GetWeatherIcon(string? description)
    {
        if (string.IsNullOrEmpty(description)) return "ğŸŒ¤ï¸";
        
        var desc = description.ToLower();
        
        // Paremmat ja vÃ¤rikkÃ¤Ã¤mmÃ¤t ikonit
        if (desc.Contains("aurinko") || desc.Contains("kirkas") || desc.Contains("selkeÃ¤")) return "â˜€ï¸";
        if (desc.Contains("loistava") || desc.Contains("upea")) return "ğŸŒ";
        if (desc.Contains("pilvi") || desc.Contains("pilvinen")) return "â›…";
        if (desc.Contains("sade") || desc.Contains("sateinen")) return "ğŸŒ¦ï¸";
        if (desc.Contains("lumi") || desc.Contains("luminen")) return "ğŸŒ¨ï¸";
        if (desc.Contains("usva") || desc.Contains("sumu")) return "ğŸŒ«ï¸";
        if (desc.Contains("myrsky") || desc.Contains("ukkonen")) return "â›ˆï¸";
        if (desc.Contains("tuuli") || desc.Contains("tuulinen")) return "ğŸŒ¬ï¸";
        if (desc.Contains("kylmÃ¤") || desc.Contains("pakkanen")) return "ğŸ¥¶";
        if (desc.Contains("kuuma") || desc.Contains("helle")) return "ğŸ”¥";
        
        return "ğŸŒ¤ï¸";
    }

    private string GetFinnishWeatherDescription(string? description)
    {
        if (string.IsNullOrEmpty(description)) return "SÃ¤Ã¤ ei tiedossa";
        
        var desc = description.ToLower();
        
        // KÃ¤Ã¤nnÃ¶kset suomeksi
        if (desc.Contains("clear sky")) return "SelkeÃ¤Ã¤";
        if (desc.Contains("few clouds")) return "VÃ¤hÃ¤n pilviÃ¤";
        if (desc.Contains("scattered clouds")) return "Hajanaisia pilviÃ¤";
        if (desc.Contains("broken clouds")) return "Melko pilvistÃ¤";
        if (desc.Contains("overcast clouds")) return "PilvistÃ¤";
        if (desc.Contains("light rain")) return "Heikkoa sadetta";
        if (desc.Contains("moderate rain")) return "Kohtalaista sadetta";
        if (desc.Contains("heavy rain")) return "Rankka sade";
        if (desc.Contains("shower rain")) return "Sadekuuroja";
        if (desc.Contains("thunderstorm")) return "Ukkosta";
        if (desc.Contains("snow")) return "Lumisadetta";
        if (desc.Contains("mist") || desc.Contains("fog")) return "Sumua";
        if (desc.Contains("haze")) return "Utuista";
        
        // Jos ei lÃ¶ydy kÃ¤Ã¤nnÃ¶stÃ¤, palautetaan alkuperÃ¤inen
        return System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase(description);
    }

    private bool IsGoodForOutdoor(string? description)
    {
        if (string.IsNullOrEmpty(description)) return true;
        var desc = description.ToLower();
        
        // HyvÃ¤ ulkoiluilma
        return desc.Contains("clear") || desc.Contains("few clouds") || 
               desc.Contains("selkeÃ¤") || desc.Contains("aurinko");
    }

    private bool IsRaining(string? description)
    {
        if (string.IsNullOrEmpty(description)) return false;
        var desc = description.ToLower();
        
        // Sateinen sÃ¤Ã¤
        return desc.Contains("rain") || desc.Contains("shower") || 
               desc.Contains("sade") || desc.Contains("sateinen");
    }

    private bool IsSnowing(string? description)
    {
        if (string.IsNullOrEmpty(description)) return false;
        var desc = description.ToLower();
        
        // Lumisade
        return desc.Contains("snow") || desc.Contains("lumi");
    }
}