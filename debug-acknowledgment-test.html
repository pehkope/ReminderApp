<!DOCTYPE html>
<html>
<head>
    <title>Kuittaus Debug - ReminderApp</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ§ª Kuittaus Debug Test</h1>
    <div id="results"></div>
    
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyPUOCR3ZwCNx_bzmBCQfSeukL69WANDBXQHzFTQg1Eygz67C8jxt3PioE54wjgeNdy/exec";
        const API_KEY = "reminder-tablet-2024";
        const CLIENT_ID = "mom";
        
        async function testAcknowledgment() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>ğŸ”„ Testaus kÃ¤ynnissÃ¤...</h2>';
            
            try {
                // 1. Hae nykyiset tehtÃ¤vÃ¤t
                console.log('ğŸ“‹ Haetaan nykyiset tehtÃ¤vÃ¤t...');
                const dataUrl = `${API_URL}?clientID=${CLIENT_ID}&apiKey=${API_KEY}&_t=${Date.now()}`;
                
                const dataResponse = await fetch(dataUrl);
                const data = await dataResponse.json();
                
                console.log('ğŸ“„ TehtÃ¤vÃ¤t:', data.dailyTasks);
                
                results.innerHTML += `<h3>ğŸ“‹ Nykyiset tehtÃ¤vÃ¤t:</h3>`;
                data.dailyTasks.forEach(task => {
                    results.innerHTML += `<p>â€¢ <strong>${task.type}</strong>: ${task.description} (Kuitattu: ${task.isAckedToday})</p>`;
                });
                
                // 2. Testaa RUOKA kuittausta
                const ruokaTask = data.dailyTasks.find(t => t.type === 'RUOKA');
                if (ruokaTask) {
                    console.log('ğŸ½ï¸ Kuitataan RUOKA tehtÃ¤vÃ¤...');
                    
                    const ackUrl = `${API_URL}?action=acknowledge&apiKey=${API_KEY}&clientID=${CLIENT_ID}&taskType=RUOKA&timeOfDay=${ruokaTask.timeOfDay}&description=${encodeURIComponent(ruokaTask.description)}`;
                    
                    console.log('ğŸŒ Kuittaus URL:', ackUrl);
                    
                    const ackResponse = await fetch(ackUrl);
                    const ackResult = await ackResponse.text();
                    
                    console.log('âœ… Kuittaus vastaus:', ackResult);
                    
                    results.innerHTML += `<h3>ğŸ½ï¸ RUOKA kuittaus:</h3>`;
                    results.innerHTML += `<p><strong>URL:</strong> ${ackUrl}</p>`;
                    results.innerHTML += `<p><strong>Vastaus:</strong> ${ackResult}</p>`;
                    
                    // 3. Hae tehtÃ¤vÃ¤t uudestaan 3 sekunnin kuluttua
                    setTimeout(async () => {
                        console.log('ğŸ”„ Haetaan pÃ¤ivitetyt tehtÃ¤vÃ¤t...');
                        
                        const newDataUrl = `${API_URL}?clientID=${CLIENT_ID}&apiKey=${API_KEY}&_t=${Date.now()}`;
                        const newDataResponse = await fetch(newDataUrl);
                        const newData = await newDataResponse.json();
                        
                        console.log('ğŸ“„ PÃ¤ivitetyt tehtÃ¤vÃ¤t:', newData.dailyTasks);
                        
                        results.innerHTML += `<h3>ğŸ”„ TehtÃ¤vÃ¤t kuittauksen jÃ¤lkeen:</h3>`;
                        newData.dailyTasks.forEach(task => {
                            const wasAcked = task.type === 'RUOKA' && task.isAckedToday;
                            const icon = wasAcked ? 'âœ…' : 'âŒ';
                            results.innerHTML += `<p>${icon} <strong>${task.type}</strong>: ${task.description} (Kuitattu: ${task.isAckedToday})</p>`;
                        });
                        
                        if (newData.dailyTasks.find(t => t.type === 'RUOKA')?.isAckedToday) {
                            results.innerHTML += `<h2 style="color: green;">âœ… KUITTAUS ONNISTUI!</h2>`;
                        } else {
                            results.innerHTML += `<h2 style="color: red;">âŒ KUITTAUS EI TOIMINUT</h2>`;
                        }
                        
                    }, 3000);
                }
                
            } catch (error) {
                console.error('âŒ Virhe testauksessa:', error);
                results.innerHTML += `<h3 style="color: red;">âŒ Virhe: ${error.message}</h3>`;
            }
        }
        
        // Aloita testaus automaattisesti
        testAcknowledgment();
    </script>
</body>
</html>